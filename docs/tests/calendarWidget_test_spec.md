# CalendarWidget テスト仕様書

## 概要
- 対象: `src/widgets/calendar/index.ts` `CalendarWidget`
- 目的: カレンダーUI・ノート連携の仕様検証

---

## テストケース一覧

| No. | テスト内容                                 | 目的                                         | 結果 | 備考 |
|-----|--------------------------------------------|----------------------------------------------|------|------|
| 1   | createでDOM生成                            | DOM構造・クラス・タイトル検証                |      |      |
| 2   | 曜日ヘッダー描画                           | 曜日表示の正しさ                             |      |      |
| 3   | 月送りボタンで月が変わる                    | 月送りUIの動作                               |      |      |
| 4   | 日付セルクリックでノート表示                | ノート情報の表示                             |      |      |
| 5   | デイリーノート無時の表示                    | 存在しない場合のメッセージ表示                |      |      |
| 6   | updateExternalSettings反映                  | 設定変更の反映                               |      |      |
| 7   | onunloadでクリーンアップ                    | 破棄時の状態確認                             |      |      |
| 8   | 祝日・今日・週末の特別表示                 | 特別な日付の装飾・クラス付与                 |      | 単体 |
| 9   | 週の開始曜日設定の反映                      | 設定値によるカレンダー表示の変化             |      | 単体 |
| 10  | 不正な設定値・日付フォーマット時の挙動      | 異常系の安全性                               |      | 単体 |
| 11  | ノート新規作成ボタン→ノート作成画面遷移     | カレンダーとノート作成画面の連携             |      | 統合 |
| 12  | 設定画面変更の即時反映                      | 設定画面とカレンダーの連携                   |      | 統合 |
| 13  | 他ウィジェットとの日付連動                   | 他ウィジェットとの連携                       |      | 統合 |
| 14  | 1000件以上ノート時のパフォーマンス           | 大規模環境での動作                           |      | システム |
| 15  | 設定ファイル破損時のデフォルト復旧           | 異常系のリカバリ                             |      | システム |
| 16  | 日付選択→ノート閲覧・作成の一連の流れ       | ユーザー操作シナリオ                         |      | UAT |
| 17  | ノートがない場合のユーザーメッセージ         | ユーザー体験                                 |      | UAT |
| 18  | キーボード操作・アクセシビリティ             | アクセシビリティ                             |      | UAT |

---

## 各テストケース詳細

### 1. createでDOM生成
- **テスト対象**: `CalendarWidget.create`
- **目的**: DOM構造・クラス・タイトルが正しいか
- **前提条件**: ダミーconfig/app/pluginを用意
- **入力値・操作**: `widget.create(config, app, plugin)`
- **期待結果**: HTMLElementが返り、`calendar-widget`クラスとタイトルが付与されている
- **手順**:
  1. ダミーconfig/app/pluginを用意
  2. createを呼び出す
  3. DOMを検証
- **実施結果記録**:

---

### 2. 曜日ヘッダー描画
- **テスト対象**: `CalendarWidget.create`
- **目的**: 曜日ヘッダー（日本語）が正しく表示されるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: create後、DOMのth要素を取得
- **期待結果**: ['日','月','火','水','木','金','土']が順に表示されている
- **手順**:
  1. create呼び出し
  2. th要素の内容を検証
- **実施結果記録**:

---

### 3. 月送りボタンで月が変わる
- **テスト対象**: `CalendarWidget.create`, `changeMonth`
- **目的**: 前月・次月ボタンで月が正しく切り替わるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: ボタンのクリックイベントを発火
- **期待結果**: currentDateの月が変化し、カレンダーが再描画される
- **手順**:
  1. create呼び出し
  2. ボタンをクリック
  3. currentDateを検証
- **実施結果記録**:

---

### 4. 日付セルクリックでノート情報が表示される
- **テスト対象**: `CalendarWidget.showNotesForDate`（内部）
- **目的**: 日付セルクリックで該当日のノート情報が正しく表示されるか
- **前提条件**: デイリーノート・その他ノートを含むダミーファイルを用意
- **入力値・操作**: 日付セル(td)のクリックイベントを発火
- **期待結果**: 選択日情報エリアに「ノート一覧」「デイリーノートを開く」「ノート名」等が表示される
- **手順**:
  1. create呼び出し
  2. tdクリック
  3. infoエリアの内容を検証
- **実施結果記録**:

---

### 5. デイリーノートが存在しない場合の表示
- **テスト対象**: `CalendarWidget.showNotesForDate`（内部）
- **目的**: デイリーノートが存在しない場合のメッセージ表示
- **前提条件**: デイリーノートが存在しないダミーファイルのみ用意
- **入力値・操作**: 日付セル(td)のクリックイベントを発火
- **期待結果**: 「デイリーノートは存在しません」と表示される
- **手順**:
  1. create呼び出し
  2. tdクリック
  3. infoエリアの内容を検証
- **実施結果記録**:

---

### 6. updateExternalSettingsで設定が反映される
- **テスト対象**: `CalendarWidget.updateExternalSettings`
- **目的**: 設定変更（dailyNoteFormat等）がcurrentSettingsに反映されるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: updateExternalSettings({ dailyNoteFormat: 'YYYY年MM月DD日' })
- **期待結果**: currentSettings.dailyNoteFormatが新しい値になる
- **手順**:
  1. create呼び出し
  2. updateExternalSettings呼び出し
  3. 設定値を検証
- **実施結果記録**:

---

### 7. onunloadでクリーンアップが行われる
- **テスト対象**: `CalendarWidget.onunload`
- **目的**: ウィジェット破棄時にwidgetEl等が適切にクリーンアップされるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: onunload呼び出し
- **期待結果**: widgetElが定義されている（現状は副作用なし）
- **手順**:
  1. create呼び出し
  2. onunload呼び出し
  3. widgetElを検証
- **実施結果記録**:

---

### 8. 祝日・今日・週末の特別表示
- **テスト対象**: `CalendarWidget.create`
- **目的**: 祝日・今日・週末に特別なクラスや装飾が付与されるか
- **前提条件**: 祝日・今日・週末を含む日付でカレンダーを描画
- **入力値・操作**: create後、該当日付セルのクラスを検証
- **期待結果**: 祝日・今日・週末に対応するクラスが付与されている
- **手順**:
  1. create呼び出し
  2. 日付セルのクラスを検証
- **実施結果記録**:

---

### 9. 週の開始曜日設定の反映
- **テスト対象**: `CalendarWidget.create`, 設定値
- **目的**: 週の開始曜日設定がカレンダー表示に反映されるか
- **前提条件**: 週の開始曜日を日曜・月曜で切り替え
- **入力値・操作**: 設定値を変更しcreate呼び出し
- **期待結果**: 曜日ヘッダー・日付配置が正しく変化する
- **手順**:
  1. 設定値を変更
  2. create呼び出し
  3. ヘッダー・日付配置を検証
- **実施結果記録**:

---

### 10. 不正な設定値・日付フォーマット時の挙動
- **テスト対象**: `CalendarWidget.create`, `updateExternalSettings`
- **目的**: 不正な設定値や日付フォーマット時に安全にフォールバックするか
- **前提条件**: 不正な値を設定
- **入力値・操作**: 不正値でcreate・updateExternalSettings呼び出し
- **期待結果**: エラーにならずデフォルト動作する
- **手順**:
  1. 不正値で呼び出し
  2. 動作・エラー出力を検証
- **実施結果記録**:

---

### 11. ノート新規作成ボタン→ノート作成画面遷移
- **テスト対象**: カレンダーUI・ノート作成画面
- **目的**: カレンダーからノート新規作成ボタンでノート作成画面が開くか
- **前提条件**: ノート作成機能が有効
- **入力値・操作**: 新規作成ボタンをクリック
- **期待結果**: ノート作成画面が開く
- **手順**:
  1. create呼び出し
  2. 新規作成ボタンをクリック
  3. 遷移を検証
- **実施結果記録**:

---

### 12. 設定画面変更の即時反映
- **テスト対象**: 設定画面・CalendarWidget
- **目的**: 設定画面での変更が即時カレンダーに反映されるか
- **前提条件**: 設定画面からカレンダー設定を変更
- **入力値・操作**: 設定画面で値を変更
- **期待結果**: カレンダー表示が即時変化
- **手順**:
  1. 設定画面で値を変更
  2. カレンダー表示を検証
- **実施結果記録**:

---

### 13. 他ウィジェットとの日付連動
- **テスト対象**: CalendarWidget・他ウィジェット
- **目的**: カレンダーで日付選択時、他ウィジェットに連動して内容が表示されるか
- **前提条件**: 連動設定が有効
- **入力値・操作**: 日付セルをクリック
- **期待結果**: 他ウィジェットに該当日付の内容が表示される
- **手順**:
  1. create呼び出し
  2. 日付セルクリック
  3. 他ウィジェットの表示を検証
- **実施結果記録**:

---

### 14. 1000件以上ノート時のパフォーマンス
- **テスト対象**: CalendarWidget
- **目的**: 大量ノート環境でも遅延なく描画されるか
- **前提条件**: 1000件以上のノートを用意
- **入力値・操作**: create呼び出し
- **期待結果**: 描画遅延が許容範囲内
- **手順**:
  1. ノートを大量に用意
  2. create呼び出し
  3. 描画速度を計測
- **実施結果記録**:

---

### 15. 設定ファイル破損時のデフォルト復旧
- **テスト対象**: CalendarWidget
- **目的**: 設定ファイル破損時にデフォルトで安全に起動できるか
- **前提条件**: 設定ファイルを破損させる
- **入力値・操作**: create呼び出し
- **期待結果**: デフォルト設定で起動しエラーにならない
- **手順**:
  1. 設定ファイルを破損
  2. create呼び出し
  3. 動作・エラー出力を検証
- **実施結果記録**:

---

### 16. 日付選択→ノート閲覧・作成の一連の流れ
- **テスト対象**: CalendarWidget・ノート機能
- **目的**: ユーザーが日付選択からノート閲覧・作成まで一連の操作ができるか
- **前提条件**: ノート機能が有効
- **入力値・操作**: 日付セルクリック→ノート閲覧・作成
- **期待結果**: 一連の流れが問題なく行える
- **手順**:
  1. 日付セルクリック
  2. ノート閲覧・作成
  3. 動作を検証
- **実施結果記録**:

---

### 17. ノートがない場合のユーザーメッセージ
- **テスト対象**: CalendarWidget
- **目的**: ノートが存在しない場合に分かりやすいメッセージが表示されるか
- **前提条件**: ノートが存在しない日付を選択
- **入力値・操作**: 日付セルクリック
- **期待結果**: 分かりやすいメッセージが表示される
- **手順**:
  1. ノートがない日付を選択
  2. メッセージ表示を検証
- **実施結果記録**:

---

### 18. キーボード操作・アクセシビリティ
- **テスト対象**: CalendarWidget
- **目的**: キーボード操作やスクリーンリーダーでカレンダーが利用できるか
- **前提条件**: アクセシビリティ機能有効
- **入力値・操作**: キーボード操作・スクリーンリーダー利用
- **期待結果**: 操作・読み上げが正しく行える
- **手順**:
  1. キーボード操作・スクリーンリーダー利用
  2. 動作・読み上げ内容を検証
- **実施結果記録**:

---

## 進捗・メモ

- [ ] ケース1 実施済み
- [ ] ケース2 未実施
- [ ] ケース3 未実施
- [ ] ケース4 未実施
- [ ] ケース5 未実施
- [ ] ケース6 未実施
- [ ] ケース7 未実施
- [ ] ケース8 未実施
- [ ] ケース9 未実施
- [ ] ケース10 未実施
- [ ] ケース11 未実施
- [ ] ケース12 未実施
- [ ] ケース13 未実施
- [ ] ケース14 未実施
- [ ] ケース15 未実施
- [ ] ケース16 未実施
- [ ] ケース17 未実施
- [ ] ケース18 未実施 