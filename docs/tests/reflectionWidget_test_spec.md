# ReflectionWidget テスト仕様書

## 概要
- 対象: `src/widgets/reflectionWidget/reflectionWidget.ts` `ReflectionWidget`
- 目的: 振り返りウィジェットのUI・設定反映・UI再描画の仕様検証

---

## テストケース一覧

| No. | テスト内容                                 | 目的                                 | 結果 | 備考 |
|-----|--------------------------------------------|--------------------------------------|------|------|
| 1   | DOM構造・UIインスタンス生成                | UI要素・UIクラスの生成               |      |      |
| 2   | create時にUIのrenderが呼ばれる             | UI初期化の副作用                     |      |      |
| 3   | updateExternalSettingsで設定反映・refresh   | 設定反映・UI再描画トリガー           |      |      |
| 4   | refreshでUIのscheduleRenderが呼ばれる       | UI再描画のトリガー                   |      |      |
| 5   | uiがnullでもrefreshでエラーにならない       | 異常系の安全性                       |      |      |
| 6   | デフォルト設定値の検証                     | 設定値の初期化                       |      |      |
| 7   | 無効な設定値の処理                         | エラーハンドリング                   |      |      |
| 8   | プリロードバンドルの処理                   | パフォーマンス最適化                 |      |      |
| 9   | UIライフサイクルの統合テスト               | コンポーネント連携                   |      |      |
| 10  | AI要約機能の統合テスト                     | LLM機能の統合                       |      |      |
| 11  | データ永続化のテスト                       | ファイルI/O機能                     |      |      |
| 12  | パフォーマンステスト                       | 大量データ処理性能                   |      |      |
| 13  | メモリリーク検証                           | メモリ管理                          |      |      |
| 14  | エラーハンドリングテスト                   | 異常系処理                          |      |      |
| 15  | アクセシビリティテスト                     | ユーザビリティ                      |      |      |

---

## 各テストケース詳細

### 1. DOM構造・UIインスタンス生成
- **テスト対象**: `ReflectionWidget.create`
- **目的**: reflection-widgetクラスやUIインスタンスが正しく生成されるか
- **前提条件**: ダミーconfig/app/pluginを用意
- **入力値・操作**: `widget.create(config, app, plugin)`
- **期待結果**: reflection-widgetクラスとUIインスタンスが生成される
- **手順**:
  1. ダミーconfig/app/pluginを用意
  2. createを呼び出す
  3. DOMとUIインスタンスを検証
- **実施結果記録**:

---

### 2. create時にUIのrenderが呼ばれる
- **テスト対象**: `ReflectionWidget.create`, `ReflectionWidgetUI.render`
- **目的**: create時にUIのrenderが呼ばれるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: create呼び出し
- **期待結果**: UIインスタンスのrenderが呼ばれる（エラーなく生成される）
- **手順**:
  1. create呼び出し
  2. UIインスタンスの存在を検証
- **実施結果記録**:

---

### 3. updateExternalSettingsで設定反映・refresh
- **テスト対象**: `ReflectionWidget.updateExternalSettings`, `ReflectionWidget.refresh`
- **目的**: updateExternalSettingsで設定値が反映され、refreshが呼ばれるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: updateExternalSettingsで設定値を変更
- **期待結果**: config.settingsが新しい値になり、refreshが呼ばれる
- **手順**:
  1. create呼び出し
  2. updateExternalSettingsで値を変更
  3. config.settingsとrefresh呼び出しを検証
- **実施結果記録**:

---

### 4. refreshでUIのscheduleRenderが呼ばれる
- **テスト対象**: `ReflectionWidget.refresh`, `ReflectionWidgetUI.scheduleRender`
- **目的**: refreshでUIのscheduleRenderが呼ばれるか
- **前提条件**: ケース1と同じ
- **入力値・操作**: refresh呼び出し
- **期待結果**: UIインスタンスのscheduleRenderが呼ばれる
- **手順**:
  1. create呼び出し
  2. refresh呼び出し
  3. scheduleRenderの呼び出しを検証
- **実施結果記録**:

---

### 5. uiがnullでもrefreshでエラーにならない
- **テスト対象**: `ReflectionWidget.refresh`
- **目的**: uiがnullでもrefreshでエラーにならないか
- **前提条件**: ケース1と同じ
- **入力値・操作**: uiをnullにしてrefresh呼び出し
- **期待結果**: エラーが発生しない
- **手順**:
  1. create呼び出し
  2. uiをnullに設定
  3. refresh呼び出し
  4. エラーが発生しないことを検証
- **実施結果記録**:

---

### 6. デフォルト設定値の検証
- **テスト対象**: `ReflectionWidget.create`
- **目的**: デフォルト設定値が正しく設定されるか
- **前提条件**: 空の設定でウィジェット作成
- **入力値・操作**: 空のsettingsでcreate呼び出し
- **期待結果**: デフォルト値が設定される
- **手順**:
  1. 空のsettingsでconfig作成
  2. create呼び出し
  3. デフォルト値を検証
- **実施結果記録**:

---

### 7. 無効な設定値の処理
- **テスト対象**: `ReflectionWidget.create`
- **目的**: 無効な設定値が渡された場合の処理
- **前提条件**: 無効な設定値を含むconfig
- **入力値・操作**: 無効なperiod値でcreate呼び出し
- **期待結果**: エラーが発生しない
- **手順**:
  1. 無効な設定値でconfig作成
  2. create呼び出し
  3. エラーが発生しないことを検証
- **実施結果記録**:

---

### 8. プリロードバンドルの処理
- **テスト対象**: `ReflectionWidget.create`
- **目的**: プリロードバンドルが正しく処理されるか
- **前提条件**: プリロードバンドル付きでcreate呼び出し
- **入力値・操作**: プリロードバンドル付きでcreate呼び出し
- **期待結果**: プリロードバンドルが正しく渡される
- **手順**:
  1. プリロードバンドルを作成
  2. create呼び出し
  3. バンドルが正しく処理されることを検証
- **実施結果記録**:

---

### 9. UIライフサイクルの統合テスト
- **テスト対象**: `ReflectionWidget`全体
- **目的**: UIのライフサイクルが正しく動作するか
- **前提条件**: ウィジェット作成済み
- **入力値・操作**: 設定変更とレンダリング
- **期待結果**: UIが正しく更新される
- **手順**:
  1. ウィジェット作成
  2. 初期レンダリング確認
  3. 設定変更
  4. 再レンダリング確認
- **実施結果記録**:

---

### 10. AI要約機能の統合テスト
- **テスト対象**: `ReflectionWidgetUI.runSummary`
- **目的**: AI要約機能が正しく動作するか
- **前提条件**: LLMマネージャーが設定済み
- **入力値・操作**: AI要約の実行
- **期待結果**: 要約が生成される
- **手順**:
  1. モックLLMマネージャーを設定
  2. 要約実行
  3. 結果を検証
- **実施結果記録**:

---

### 11. データ永続化のテスト
- **テスト対象**: `ReflectionWidgetUI.saveReflectionSummary`
- **目的**: 要約データが正しく保存されるか
- **前提条件**: モックファイルシステム
- **入力値・操作**: 要約データの保存
- **期待結果**: データが正しく保存される
- **手順**:
  1. モックファイルシステムを設定
  2. 要約データ保存
  3. 保存結果を検証
- **実施結果記録**:

---

### 12. パフォーマンステスト
- **テスト対象**: `ReflectionWidget`全体
- **目的**: 大量データでの性能
- **前提条件**: 大量データ
- **入力値・操作**: 大量データでのレンダリング
- **期待結果**: 1秒以内に完了
- **手順**:
  1. 大量データを準備
  2. レンダリング実行
  3. 実行時間を測定
- **実施結果記録**:

---

### 13. メモリリーク検証
- **テスト対象**: `ReflectionWidget`全体
- **目的**: メモリリークがないか
- **前提条件**: メモリ情報が利用可能
- **入力値・操作**: 複数回の作成・破棄
- **期待結果**: メモリ増加が10MB以内
- **手順**:
  1. 初期メモリ使用量を記録
  2. 複数回の作成・破棄を実行
  3. 最終メモリ使用量を比較
- **実施結果記録**:

---

### 14. エラーハンドリングテスト
- **テスト対象**: `ReflectionWidget`全体
- **目的**: エラーが適切に処理されるか
- **前提条件**: エラーを発生させる条件
- **入力値・操作**: エラーを発生させる操作
- **期待結果**: エラーが発生してもクラッシュしない
- **手順**:
  1. エラーを発生させる条件を設定
  2. 操作を実行
  3. エラーハンドリングを検証
- **実施結果記録**:

---

### 15. アクセシビリティテスト
- **テスト対象**: `ReflectionWidget`UI
- **目的**: アクセシビリティ要件を満たすか
- **前提条件**: ウィジェット作成済み
- **入力値・操作**: DOM要素の確認
- **期待結果**: ARIA属性が設定され、キーボード操作が可能であること
- **手順**:
  1. ウィジェット作成
  2. DOM要素のARIA属性を確認
  3. 主要な操作要素がキーボードでフォーカス可能か検証
- **実施結果記録**:

---

## 進捗・メモ

- [x] ケース1 実施済み
- [x] ケース2 実施済み
- [x] ケース3 実施済み
- [x] ケース4 実施済み
- [x] ケース5 実施済み
- [x] ケース6 追加済み
- [x] ケース7 追加済み
- [x] ケース8 追加済み
- [x] ケース9 追加済み
- [x] ケース10 追加済み
- [x] ケース11 追加済み
- [x] ケース12 追加済み
- [x] ケース13 追加済み
- [x] ケース14 追加済み
- [x] ケース15 追加済み

## テストカテゴリ別分類

### 単体テスト
- ケース1-5: 基本機能テスト
- ケース6-8: 設定値・プリロードテスト

### 統合テスト
- ケース9-11: UI・AI機能・データ永続化の統合

### システムテスト
- ケース12-15: パフォーマンス・エラーハンドリング・アクセシビリティ 